<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Media Advertising - Quotation Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.14/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a73e8;
            --secondary: #e8f0fe;
            --accent: #ff6d00;
            --dark: #202124;
            --light: #f8f9fa;
            --success: #0f9d58;
            --danger: #db4437;
            --border: #ddd;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7f9;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary), #0d47a1);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header-content h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header-content p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.6rem;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            align-items: center;
        }

        .card-title i {
            margin-right: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .col {
            flex: 1;
            padding: 0 10px;
            min-width: 300px;
        }

        .btn {
            display: inline-block;
            padding: 14px 28px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn i {
            margin-right: 8px;
        }

        .btn:hover {
            background: #0d47a1;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #0c8749;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #c23321;
        }

        .service-item {
            background: var(--secondary);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .service-title {
            font-weight: 700;
            font-size: 19px;
            color: var(--dark);
        }

        .remove-service {
            color: var(--danger);
            cursor: pointer;
            font-weight: bold;
            font-size: 22px;
            padding: 5px;
        }

        .summary-table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .summary-table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            margin: 25px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .summary-table th, .summary-table td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .summary-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }

        .summary-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .summary-table tr:last-child {
            font-weight: bold;
            background-color: #f1f8ff;
        }

        .totals {
            font-size: 1.3rem;
            text-align: right;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px dashed var(--border);
        }
        
        .currency {
            font-weight: 700;
            color: var(--success);
        }

        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .main-footer {
            text-align: center;
            margin-top: 50px;
            padding: 30px;
            color: #666;
            font-size: 1rem;
            background: #f8f9fa;
            border-top: 1px solid var(--border);
        }

        @media (max-width: 768px) {
            .row {
                flex-direction: column;
            }

            .col {
                width: 100%;
                margin-bottom: 15px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
                text-align: center;
            }

            header {
                padding: 15px;
            }

            .header-content h1 {
                font-size: 1.8rem;
            }

            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Sign Media Advertising Agency</h1>
            </div>
        </header>

        <div class="content">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-image"></i> Company Logo</h2>
                <div class="form-group">
                    <label for="logoUpload">Upload Company Logo</label>
                    <input type="file" id="logoUpload" accept="image/*">
                </div>
            </div>

            <div class="card">
                <h2 class="card-title"><i class="fas fa-building"></i> Client Information</h2>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="companyName">Company Name *</label>
                            <input type="text" id="companyName" placeholder="Enter client company name" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="contactPerson">Contact Person *</label>
                            <input type="text" id="contactPerson" placeholder="Enter contact person name" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="contactNumber">Contact Number *</label>
                            <input type="text" id="contactNumber" placeholder="Enter contact number" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" placeholder="Enter email address">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title"><i class="fas fa-concierge-bell"></i> Services Selection</h2>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="serviceType">Service Type *</label>
                            <select id="serviceType">
                                <option value="">Select a service</option>
                                <option value="billboard">Billboards & Hoardings</option>
                                <option value="streamers">Streamers & Pole Signs</option>
                                <option value="digital">Digital LED Streamers</option>
                                <option value="wraps">Building Wraps & Uni Poles</option>
                                <option value="event">Event Management</option>
                                <option value="mall">Mall & Event Branding</option>
                                <option value="led">SMD / LED Screens</option>
                                <option value="bus">Bus Shelters</option>
                                <option value="roundabout">Roundabout Branding</option>
                                <option value="signs">3D Signs & Fabrication</option>
                                <option value="expo">Expo Stall</option>
                                <option value="vehicle">Vehicle Branding</option>
                                <option value="kiosk">Kiosk</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="quantity">Quantity *</label>
                            <input type="number" id="quantity" min="1" value="1" placeholder="Enter quantity">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="rentOption">Rent Option *</label>
                            <select id="rentOption">
                                <option value="">Select a rent period</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="semi-annually">Semi-Annually</option>
                                <option value="annually">Annually</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="rentRate">Rent Rate (PKR) *</label>
                            <input type="number" id="rentRate" min="0" value="0" placeholder="Enter rent amount">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="size">Size (in sq ft) *</label>
                            <input type="text" id="size" placeholder="e.g., 10x15, 120 sq ft">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="materialRate">Material Rate (PKR per sq ft) *</label>
                            <input type="number" id="materialRate" min="0" value="0" placeholder="Enter rate">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="materialDescription">Printing / Material Details</label>
                    <textarea id="materialDescription" rows="2" placeholder="e.g., Vinyl printing, Flex printing, etc."></textarea>
                </div>
                <div class="form-group">
                    <label for="otherCharges">Fitting & Other Charges (PKR)</label>
                    <input type="number" id="otherCharges" min="0" value="0" placeholder="Enter charges">
                </div>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="city">City *</label>
                            <input type="text" id="city" placeholder="Enter city">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="tmaTax">TMA Tax (PKR) *</label>
                            <input type="number" id="tmaTax" min="0" value="0" placeholder="Enter TMA tax amount">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="locationDetails">Location Details *</label>
                    <textarea id="locationDetails" rows="2" placeholder="Enter specific road/location details"></textarea>
                </div>
                <button class="btn" id="addService"><i class="fas fa-plus-circle"></i> Add Service</button>
            </div>

            <div class="card">
                <h2 class="card-title"><i class="fas fa-list-alt"></i> Selected Services</h2>
                <div id="servicesList"></div>

                <h2 class="card-title"><i class="fas fa-file-invoice-dollar"></i> Quotation Summary</h2>
                <div class="summary-table-container">
                    <table class="summary-table">
                        <thead>
                            <tr>
                                <th>Service</th>
                                <th>Details</th>
                                <th>Qty</th>
                                <th>Rent (PKR)</th>
                                <th>Printing (PKR)</th>
                                <th>Other (PKR)</th>
                                <th>Total (PKR)</th>
                            </tr>
                        </thead>
                        <tbody id="summaryBody"></tbody>
                    </table>
                </div>

                <div class="totals">
                    <div>Subtotal: <span class="currency" id="subtotal">PKR 0.00</span></div>
                    <div>TMA Tax: <span class="currency" id="tmaTaxAmount">PKR 0.00</span></div>
                    <div>Grand Total: <span class="currency" id="totalAmount">PKR 0.00</span></div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title"><i class="fas fa-file-contract"></i> Terms & Conditions</h2>
                <div class="form-group">
                    <label for="terms">Terms & Conditions *</label>
                    <textarea id="terms" rows="4" placeholder="Enter terms and conditions">1. Payment terms: 50% advance, 50% on completion.
2. Validity of quotation: 30 days.
3. Installation not included unless specified.
4. Changes after approval may incur additional charges.
5. Prices subject to change based on market conditions.
6. TMA taxes are subject to change as per local authority regulations.
7. All amounts are in Pakistani Rupees (PKR).</textarea>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" id="resetForm"><i class="fas fa-redo-alt"></i> Reset Form</button>
                <button class="btn btn-success" id="generatePDF"><i class="fas fa-file-pdf"></i> Download PDF Quotation</button>
            </div>
        </div>

        <footer class="main-footer">
            <p>Sign Media Advertising Agency &copy; 2025. All rights reserved.</p>
            <p class="address">Office # 33, Chenab Market, Susan Road, Faisalabad</p>
        </footer>
    </div>

    <script>
        let services = [];
        let logoData = null;

        const addServiceBtn = document.getElementById('addService');
        const resetFormBtn = document.getElementById('resetForm');
        const generatePDFBtn = document.getElementById('generatePDF');
        const servicesList = document.getElementById('servicesList');
        const summaryBody = document.getElementById('summaryBody');
        const subtotalEl = document.getElementById('subtotal');
        const tmaTaxAmountEl = document.getElementById('tmaTaxAmount');
        const totalAmountEl = document.getElementById('totalAmount');
        const logoUpload = document.getElementById('logoUpload');

        logoUpload.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoData = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        addServiceBtn.addEventListener('click', function() {
            const serviceType = document.getElementById('serviceType');
            const quantity = document.getElementById('quantity');
            const rentOption = document.getElementById('rentOption');
            const rentRate = document.getElementById('rentRate');
            const size = document.getElementById('size');
            const materialRate = document.getElementById('materialRate');
            const materialDescription = document.getElementById('materialDescription');
            const otherCharges = document.getElementById('otherCharges');
            const city = document.getElementById('city');
            const tmaTax = document.getElementById('tmaTax');
            const locationDetails = document.getElementById('locationDetails');

            if (!serviceType.value || !quantity.value || !rentOption.value || !rentRate.value || !size.value || !materialRate.value || !city.value || !locationDetails.value || !tmaTax.value) {
                alert('Please fill in all required fields marked with *');
                return;
            }

            const area = calculateArea(size.value);
            const printingCost = area * parseFloat(materialRate.value);
            const totalServiceCost = (parseFloat(rentRate.value) + printingCost + parseFloat(otherCharges.value)) * parseInt(quantity.value);

            const service = {
                id: Date.now(),
                type: serviceType.options[serviceType.selectedIndex].text,
                quantity: parseInt(quantity.value),
                rentOption: rentOption.options[rentOption.selectedIndex].text,
                rentRate: parseFloat(rentRate.value),
                size: size.value,
                area: area,
                materialRate: parseFloat(materialRate.value),
                materialDescription: materialDescription.value,
                printingCost: printingCost,
                otherCharges: parseFloat(otherCharges.value),
                city: city.value,
                tmaTax: parseFloat(tmaTax.value),
                location: locationDetails.value,
                total: totalServiceCost
            };

            services.push(service);
            updateServicesList();
            updateSummary();
            
            // Reset fields except client info and terms
            serviceType.value = '';
            quantity.value = '1';
            rentOption.value = '';
            rentRate.value = '0';
            size.value = '';
            materialRate.value = '0';
            materialDescription.value = '';
            otherCharges.value = '0';
            city.value = '';
            tmaTax.value = '0';
            locationDetails.value = '';
        });

        function calculateArea(size) {
            if (size.includes('x')) {
                const dimensions = size.split('x');
                if (dimensions.length === 2) {
                    return parseFloat(dimensions[0]) * parseFloat(dimensions[1]);
                }
            }
            return parseFloat(size) || 0;
        }

        function updateServicesList() {
            servicesList.innerHTML = '';
            services.forEach(service => {
                const serviceEl = document.createElement('div');
                serviceEl.className = 'service-item';
                serviceEl.innerHTML = `
                    <div class="service-header">
                        <div class="service-title">${service.type} (${service.size})</div>
                        <div class="remove-service" data-id="${service.id}">Ã—</div>
                    </div>
                    <p><strong>Location:</strong> ${service.city} - ${service.location}</p>
                    <p><strong>Rent:</strong> PKR ${service.rentRate.toLocaleString('en-PK')} (${service.rentOption})</p>
                    <p><strong>Printing:</strong> ${service.materialDescription || 'N/A'} (PKR ${service.printingCost.toLocaleString('en-PK')})</p>
                    <p><strong>Other Charges:</strong> PKR ${service.otherCharges.toLocaleString('en-PK')}</p>
                    <p><strong>Total for this item:</strong> PKR ${service.total.toLocaleString('en-PK')}</p>
                `;
                servicesList.appendChild(serviceEl);
            });

            document.querySelectorAll('.remove-service').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    services = services.filter(service => service.id !== id);
                    updateServicesList();
                    updateSummary();
                });
            });
        }

        function updateSummary() {
            summaryBody.innerHTML = '';
            let subtotal = 0;
            let totalTmaTax = 0;

            services.forEach(service => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${service.type}</td>
                    <td>
                        <p><strong>Size:</strong> ${service.size}</p>
                        <p><strong>Rent:</strong> ${service.rentOption} (PKR ${service.rentRate.toLocaleString('en-PK')})</p>
                        <p><strong>Printing:</strong> ${service.materialDescription} (PKR ${service.printingCost.toLocaleString('en-PK')})</p>
                        <p><strong>Other:</strong> (PKR ${service.otherCharges.toLocaleString('en-PK')})</p>
                        <p><strong>Location:</strong> ${service.location}</p>
                    </td>
                    <td>${service.quantity}</td>
                    <td>PKR ${(service.rentRate * service.quantity).toLocaleString('en-PK')}</td>
                    <td>PKR ${(service.printingCost * service.quantity).toLocaleString('en-PK')}</td>
                    <td>PKR ${(service.otherCharges * service.quantity).toLocaleString('en-PK')}</td>
                    <td>PKR ${service.total.toLocaleString('en-PK')}</td>
                `;
                summaryBody.appendChild(row);
                subtotal += service.total;
                totalTmaTax += service.tmaTax;
            });

            const grandTotal = subtotal + totalTmaTax;
            subtotalEl.textContent = `PKR ${subtotal.toLocaleString('en-PK')}`;
            tmaTaxAmountEl.textContent = `PKR ${totalTmaTax.toLocaleString('en-PK')}`;
            totalAmountEl.textContent = `PKR ${grandTotal.toLocaleString('en-PK')}`;
        }

        resetFormBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to reset the form? All data will be lost.')) {
                document.querySelectorAll('input, select, textarea').forEach(element => {
                    if (element.id !== 'terms') {
                        element.value = '';
                    }
                });
                document.getElementById('quantity').value = '1';
                document.getElementById('rentRate').value = '0';
                document.getElementById('materialRate').value = '0';
                document.getElementById('otherCharges').value = '0';
                document.getElementById('tmaTax').value = '0';
                
                logoData = null;
                services = [];
                updateServicesList();
                updateSummary();
            }
        });

        generatePDFBtn.addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const margin = 15;

            function addWatermark(doc, logo) {
                if (logo) {
                    const img = new Image();
                    img.src = logo;
                    img.onload = function() {
                        const imgWidth = 80;
                        const imgHeight = (img.height * imgWidth) / img.width;
                        const x = (doc.internal.pageSize.getWidth() - imgWidth) / 2;
                        const y = (doc.internal.pageSize.getHeight() - imgHeight) / 2;
                        
                        doc.setGState(new doc.GState({opacity: 0.1}));
                        doc.addImage(logo, 'PNG', x, y, imgWidth, imgHeight);
                        doc.setGState(new doc.GState({opacity: 1}));
                    };
                }
            }

            function addLetterhead(doc, logo) {
                // Header
                doc.setFontSize(14);
                doc.setTextColor('#1a73e8'); // Dark Blue
                doc.setFont('helvetica', 'bold');
                doc.text("SIGN MEDIA ADVERTISING AGENCY", margin, 20);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'normal');
                doc.text("Creative Solutions for a Bolder Brand Image", margin, 25);
                
                // Header Line
                doc.setDrawColor('#ff6d00'); // Orange
                doc.line(margin, 30, pageWidth - margin, 30);
                
                // Footer
                doc.setDrawColor('#ff6d00'); // Orange
                doc.line(margin, pageHeight - 25, pageWidth - margin, pageHeight - 25);
                
                doc.setFontSize(8);
                doc.setTextColor('#202124'); // Dark text
                doc.setFont('helvetica', 'normal');
                
                doc.text('Mobile: 03338333362 | Email: awais@signmediaadvertising.com', margin, pageHeight - 15);
                doc.text('Website: www.signmediaadvertising.com', pageWidth - margin, pageHeight - 15, {align: 'right'});
                doc.text('Office # 33, Chenab Market, Susan Road, Faisalabad', pageWidth - margin, pageHeight - 10, {align: 'right'});
                
            }

            // Generate PDF
            pdf.setProperties({
                title: 'Sign Media Quotation',
                subject: 'Quotation for Services',
                author: 'Sign Media Advertising Agency',
                creator: 'Quotation Generator'
            });

            addWatermark(pdf, logoData);
            addLetterhead(pdf, logoData);

            let y = 40; // Start content below the header
            const contentWidth = pageWidth - 2 * margin;

            // Client Info
            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(0, 0, 0);
            pdf.text("Quotation for:", margin, y);
            y += 7;
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Company Name: ${document.getElementById('companyName').value || 'N/A'}`, margin, y);
            y += 5;
            pdf.text(`Contact Person: ${document.getElementById('contactPerson').value || 'N/A'}`, margin, y);
            y += 5;
            pdf.text(`Contact Number: ${document.getElementById('contactNumber').value || 'N/A'}`, margin, y);
            y += 5;
            pdf.text(`Email Address: ${document.getElementById('email').value || 'N/A'}`, margin, y);
            y += 10;
            
            // Quotation Summary Table
            const tableData = services.map(service => {
                return [
                    service.type,
                    `Size: ${service.size}\nRent: ${service.rentOption} (PKR ${service.rentRate.toLocaleString('en-PK')})\nPrinting: ${service.materialDescription} (PKR ${service.printingCost.toLocaleString('en-PK')})\nOther: (PKR ${service.otherCharges.toLocaleString('en-PK')})\nLocation: ${service.location}`,
                    service.quantity,
                    `PKR ${service.total.toLocaleString('en-PK')}`
                ];
            });

            pdf.autoTable({
                startY: y,
                head: [['Service', 'Details', 'Qty', 'Amount (PKR)']],
                body: tableData,
                columnStyles: {
                    0: { cellWidth: 35 },
                    1: { cellWidth: 80 },
                    2: { cellWidth: 15 },
                    3: { cellWidth: 50 },
                },
                didDrawPage: (data) => {
                    addLetterhead(pdf, logoData);
                    addWatermark(pdf, logoData);
                },
                margin: { top: 40, left: margin, right: margin }
            });

            let finalY = pdf.autoTable.previous.finalY;

            let subtotal = 0;
            let totalTmaTax = 0;
            services.forEach(s => {
                subtotal += s.total;
                totalTmaTax += s.tmaTax;
            });
            const grandTotal = subtotal + totalTmaTax;

            if (finalY > pageHeight - 80) {
                pdf.addPage();
                finalY = 40;
            } else {
                 finalY += 10;
            }
            
            // Totals
            pdf.setFontSize(12);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(0, 0, 0);
            pdf.text(`Subtotal: PKR ${subtotal.toLocaleString('en-PK')}`, pageWidth - margin, finalY, { align: 'right' });
            finalY += 7;
            pdf.text(`TMA Tax: PKR ${totalTmaTax.toLocaleString('en-PK')}`, pageWidth - margin, finalY, { align: 'right' });
            finalY += 7;
            pdf.text(`Grand Total: PKR ${grandTotal.toLocaleString('en-PK')}`, pageWidth - margin, finalY, { align: 'right' });
            finalY += 15;
            
            // Terms and Conditions
            const termsText = document.getElementById('terms').value;
            const termsLines = pdf.splitTextToSize(termsText, contentWidth);
            const termsHeight = termsLines.length * 5; 
            
            if (finalY + termsHeight > pageHeight - 50) {
                pdf.addPage();
                finalY = 40;
            }

            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'bold');
            pdf.text("Terms & Conditions", margin, finalY);
            finalY += 7;
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'normal');
            pdf.text(termsLines, margin, finalY);

            pdf.save(`${document.getElementById('companyName').value || 'Quotation'}_${new Date().toLocaleDateString()}.pdf`);
        });

    </script>
</body>
</html>
